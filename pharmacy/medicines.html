<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmacia Nucului Batran - Medicamente</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="medicine-styles.css">
    <style>
        .theme-toggle {
            background: none;
            border: 2px solid var(--primary-color);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            background: var(--primary-color);
            color: var(--card-color);
        }

        .theme-toggle .icon {
            font-size: 1.2em;
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="color: var(--primary-color);">Farmacia Nucului Batran</h1>
            <nav class="nav-links">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span class="icon" id="themeIcon">üåô</span>
                    <span id="themeText">Mod √éntunecat</span>
                </button>
                <a href="index.html">AcasƒÉ</a>
                <a href="#" onclick="showSignIn()">Autentificare</a>
                <a href="#" style="position: relative;" class="basket-icon" onclick="showBasket()">
                    üõí Co»ô <span id="cart-count" style="background: var(--primary-dark); padding: 2px 6px; border-radius: 10px; font-size: 0.8em;">0</span>
                </a>
            </nav>
        </div>
    </header>

    <main class="main-content" style="padding-top: 2rem;">
        <div class="container">
        <div class="card filters-card" style="margin-bottom: 2rem; border-bottom: 3px solid var(--primary-color); padding-bottom: 1rem;">
            <div class="filters" style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 0.5rem;">
                <div class="filter-group" style="min-width: 160px; display: flex; flex-direction: column; gap: 0.15rem; margin: 0; justify-content: center;">
                    <label class="label" style="font-size: 0.75em; margin: 0; line-height: 1;">CƒÉutare</label>
                    <input type="text" id="searchInput" placeholder="CautƒÉ..." oninput="filterProducts()" style="width: 100%; padding: 5px 6px; font-size: 0.9em; border: 1px solid var(--border-color); border-radius: 4px; background: var(--background-color); color: var(--text-color); margin: 0; line-height: 1.2;">
                </div>
                <div class="filter-group" style="min-width: 120px; display: flex; flex-direction: column; gap: 0.15rem; margin: 0; justify-content: center;">
                    <label class="label" style="font-size: 0.75em; margin: 0; line-height: 1;">Categorie</label>
                    <select id="categoryFilter" onchange="filterProducts()" style="width: 100%; padding: 5px 6px; font-size: 0.9em; border: 1px solid var(--border-color); border-radius: 4px; background: var(--background-color); color: var(--text-color); margin: 0; line-height: 1.2;">
                        <option value="all">Toate</option>
                        <option value="cold">RƒÉcealƒÉ »ôi GripƒÉ</option>
                        <option value="throat">Dureri √Æn G√¢t</option>
                        <option value="cough">Tuse</option>
                        <option value="painkillers">Analgezice</option>
                        <option value="antibiotics">Antibiotice</option>
                        <option value="vitamins">Vitamine</option>
                        <option value="supplements">Suplimente</option>
                        <option value="allergy">Antialergice</option>
                        <option value="heart">Cardiovascular</option>
                        <option value="digestive">Digestiv</option>
                        <option value="respiratory">Respirator</option>
                    </select>
                </div>
                <div class="filter-group" style="min-width: 110px; display: flex; flex-direction: column; gap: 0.15rem; margin: 0; justify-content: center;">
                    <label class="label" style="font-size: 0.75em; margin: 0; line-height: 1;">Re»õetƒÉ</label>
                    <select id="prescriptionFilter" onchange="filterProducts()" style="width: 100%; padding: 5px 6px; font-size: 0.9em; border: 1px solid var(--border-color); border-radius: 4px; background: var(--background-color); color: var(--text-color); margin: 0; line-height: 1.2;">
                        <option value="all">Toate</option>
                        <option value="yes">Cu Re»õetƒÉ</option>
                        <option value="no">FƒÉrƒÉ Re»õetƒÉ</option>
                    </select>
                </div>
                <div class="filter-group" style="min-width: 130px; display: flex; flex-direction: column; gap: 0.15rem; margin: 0; justify-content: center;">
                    <label class="label" style="font-size: 0.75em; margin: 0; line-height: 1;">Pre»õ Max:</label>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <input id="priceRange" type="range" min="0" max="200" value="200" class="price-range" oninput="updatePriceValue(this.value)" style="flex: 1; height: 6px;">
                        <span id="priceValue" class="price-label" style="min-width: 40px; font-size: 0.75em; line-height: 1;">200 Lei</span>
                    </div>
                </div>
                <button onclick="toggleFilterCard()" style="background: var(--primary-color); color: var(--card-color); padding: 5px 10px; font-size: 0.85em; border-radius: 4px; border: none; cursor: pointer; font-weight: 500; white-space: nowrap; height: fit-content; line-height: 1.3;">Ascunde</button>
                <button onclick="resetAllFilters()" style="background: var(--primary-dark); color: var(--card-color); padding: 5px 10px; font-size: 0.85em; border-radius: 4px; border: none; cursor: pointer; font-weight: 500; white-space: nowrap; height: fit-content; line-height: 1.3;">ReseteazƒÉ</button>
                <select onchange="changeGridLayout(this.value)" style="background: var(--background-color); color: var(--text-color); padding: 5px 10px; font-size: 0.85em; border-radius: 4px; border: 1px solid var(--border-color); cursor: pointer; white-space: nowrap; height: fit-content; line-height: 1.3;">
                    <option value="3">3 Col</option>
                    <option value="2">2 Col</option>
                    <option value="4">4 Col</option>
                </select>
            </div>
        </div>

        <div class="product-grid">
            <div class="card product-card">
                <h3>Theraflu Extra Grip</h3>
                <div class="tabs">
                    <button class="tab active" onclick="openTab(event, 'descriptionTheraflu')">Descriere</button>
                </div>
                <div id="descriptionTheraflu" class="tab-content active">
                    <p>Pulbere pentru solu»õie oralƒÉ. Tratamentul simptomatic al rƒÉcelii »ôi gripei.</p>
                    <p>Cantitate √Æn stoc: 45</p>
                    <p style="color: var(--primary-color); font-weight: bold; font-size: 1.2em;">35.99 Lei</p>
                </div>
                <button onclick="addToCart('Theraflu Extra Grip')">AdaugƒÉ √Æn Co»ô</button>
            </div>

            <div class="card product-card">
                <h3>Parasinus</h3>
                <div class="tabs">
                    <button class="tab active" onclick="openTab(event, 'descriptionParasinus')">Descriere</button>
                </div>
                <div id="descriptionParasinus" class="tab-content active">
                    <p>Pentru congestie nazalƒÉ »ôi dureri sinusale. 12 comprimate.</p>
                    <p>Cantitate √Æn stoc: 60</p>
                    <p style="color: var(--primary-color); font-weight: bold; font-size: 1.2em;">28.99 Lei</p>
                </div>
                <button onclick="addToCart('Parasinus')">AdaugƒÉ √Æn Co»ô</button>
            </div>

            <div class="card product-card">
                <h3>Strepsils Intensiv Miere & LƒÉm√¢ie</h3>
                <div class="tabs">
                    <button class="tab active" onclick="openTab(event, 'descriptionStrepsils')">Descriere</button>
                </div>
                <div id="descriptionStrepsils" class="tab-content active">
                    <p>Pastile pentru dureri √Æn g√¢t. 24 pastile.</p>
                    <p>Cantitate √Æn stoc: 80</p>
                    <p style="color: var(--primary-color); font-weight: bold; font-size: 1.2em;">25.99 Lei</p>
                </div>
                <button onclick="addToCart('Strepsils Intensiv')">AdaugƒÉ √Æn Co»ô</button>
            </div>

            <!-- Medicamente pentru Tuse - FƒÉrƒÉ Re»õetƒÉ -->
            <div class="card product-card">
                <h3>ACC 600mg</h3>
                <div class="tabs">
                    <button class="tab active" onclick="openTab(event, 'descriptionACC')">Descriere</button>
                </div>
                <div id="descriptionACC" class="tab-content active">
                    <p>Expectorant pentru tuse productivƒÉ. 10 plicuri efervescente.</p>
                    <p>Cantitate √Æn stoc: 40</p>
                    <p style="color: var(--primary-color); font-weight: bold; font-size: 1.2em;">32.99 Lei</p>
                </div>
                <button onclick="addToCart('ACC 600')">AdaugƒÉ √Æn Co»ô</button>
            </div>

            <!-- Vitamine »ôi Suplimente - FƒÉrƒÉ Re»õetƒÉ -->
            <div class="card product-card">
                <h3>Vitamina C 1000mg</h3>
                <div class="tabs">
                    <button class="tab active" onclick="openTab(event, 'descriptionVitC')">Descriere</button>
                </div>
                <div id="descriptionVitC" class="tab-content active">
                    <p>Sus»õine sistemul imunitar. 20 comprimate efervescente.</p>
                    <p>Cantitate √Æn stoc: 100</p>
                    <p style="color: var(--primary-color); font-weight: bold; font-size: 1.2em;">29.99 Lei</p>
                </div>
                <button onclick="addToCart('Vitamina C 1000mg')">AdaugƒÉ √Æn Co»ô</button>
            </div>

            <!-- Antibiotice - Cu Re»õetƒÉ -->
            <div class="card product-card">
                <h3>Augmentin 1000mg</h3>
                <div class="tabs">
                    <button class="tab active" onclick="openTab(event, 'descriptionAugmentin')">Descriere</button>
                </div>
                <div id="descriptionAugmentin" class="tab-content active">
                    <p>Antibiotic cu spectru larg. 10 comprimate filmate.</p>
                    <p>Cantitate √Æn stoc: 25</p>
                    <p style="color: var(--primary-color); font-weight: bold; font-size: 1.2em;">65.99 Lei</p>
                    <p><strong style="color: var(--primary-dark);">‚öïÔ∏è NecesitƒÉ Re»õetƒÉ</strong></p>
                </div>
                <button onclick="addToCart('Augmentin', true)">AdaugƒÉ √Æn Co»ô (NecesitƒÉ Re»õetƒÉ)</button>
            </div>

            <!-- Antitermice - FƒÉrƒÉ Re»õetƒÉ -->
            <div class="card product-card">
                <h3>Paracetamol 500mg</h3>
                <div class="tabs">
                    <button class="tab active" onclick="openTab(event, 'descriptionParacetamol')">Descriere</button>
                </div>
                <div id="descriptionParacetamol" class="tab-content active">
                    <p>Antitermic »ôi analgezic. 20 comprimate.</p>
                    <p>Cantitate √Æn stoc: 150</p>
                    <p style="color: var(--primary-color); font-weight: bold; font-size: 1.2em;">15.99 Lei</p>
                </div>
                <button onclick="addToCart('Paracetamol')">AdaugƒÉ √Æn Co»ô</button>
            </div>

            <!-- More products will be loaded dynamically -->
        </div>
    </main>

    <!-- Cart Hover Popup -->
    <div class="cart-popup" id="cartPopup" style="display: none; position: absolute; right: 20px; top: 80px; background: var(--background-color); border: 1px solid var(--border-color); padding: 1rem; border-radius: 8px; box-shadow: var(--shadow); min-width: 300px; z-index: 1000;">
        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Co»ôul meu</h3>
        <div id="cartItems" style="max-height: 300px; overflow-y: auto;">
        </div>
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
            <p style="display: flex; justify-content: space-between;">
                <span>Total:</span>
                <span id="cartTotal" style="font-weight: bold; color: var(--primary-color)">0.00 Lei</span>
            </p>
        </div>
        <div style="margin-top: 1rem; display:flex; justify-content:space-between; gap:8px; align-items:center;">
            <input type="file" id="prescriptionUpload" accept="image/*,application/pdf" style="display:none" />
            <div style="display:flex; gap:8px;">
                <button id="checkoutBtn" onclick="checkout()" style="background:var(--primary-color); color:var(--card-color); padding:8px 12px; border-radius:6px; border:none; cursor:pointer;">FinalizeazƒÉ comanda</button>
                <button onclick="clearCart()" style="background:transparent; border:1px solid var(--border-color); padding:8px 12px; border-radius:6px; cursor:pointer;">Gole»ôte co»ôul</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>

    <script>
        let cart = [];
        let products = [];
        let cartCount = 0;

        // Load all products when page loads
        window.onload = function() {
            loadAllProducts();
            const cartIcon = document.querySelector('.basket-icon');
            const cartPopup = document.getElementById('cartPopup');
            
            cartIcon.addEventListener('mouseenter', () => {
                cartPopup.style.display = 'block';
                updateCartDisplay();
            });

            cartIcon.addEventListener('mouseleave', (e) => {
                const rect = cartPopup.getBoundingClientRect();
                if (
                    e.clientX < rect.left ||
                    e.clientX > rect.right ||
                    e.clientY < rect.top ||
                    e.clientY > rect.bottom
                ) {
                    cartPopup.style.display = 'none';
                }
            });

            cartPopup.addEventListener('mouseleave', () => {
                cartPopup.style.display = 'none';
            });
        }

        function loadAllProducts() {
            //* Fetch medicines data from server
            fetch('api/get-medicines.php')
                //* Parse response
                .then(response => response.json())
                //* Process medicines data
                .then(data => {
                    if (data.success && data.medicines) {
                        //* Map database medicines to products format
                        products = data.medicines.map(medicine => ({
                            id: medicine.id,
                            name: medicine.name,
                            price: medicine.price,
                            description: medicine.description,
                            short_description: medicine.short_description,
                            net_weight: medicine.net_weight,
                            prescription: medicine.requires_prescription,
                            stock: medicine.stock_quantity,
                            sideEffects: medicine.side_effects || [],
                            categories: medicine.categories || []
                        }));
                        //* Render products on page
                        renderProducts(products);
                    } else {
                        console.error('Error loading medicines:', data.message);
                        //* Show error message to user
                        const grid = document.querySelector('.product-grid');
                        grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: red;">Eroare la √ÆncƒÉrcarea medicamentelor</p>';
                    }
                })
                //* Handle fetch errors
                .catch(error => {
                    console.error('Fetch error:', error);
                    const grid = document.querySelector('.product-grid');
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: red;">Eroare la conectare: ' + error.message + '</p>';
                });
        }

        // prescription popup removed from page (upload moved to checkout flow)

        // Product detail popup: show full prescription-like details, administration and full side effects
        function showProductDetails(productName) {
            const product = products.find(p => p.name === productName);
            if (!product) return;

            const overlay = document.getElementById('overlay');
            overlay.style.display = 'block';

            let popup = document.getElementById('productDetailPopup');
            if (!popup) {
                // create container if not present (should be present in DOM normally)
                popup = document.createElement('div');
                popup.id = 'productDetailPopup';
                popup.className = 'product-detail-popup card';
                document.body.appendChild(popup);
            }

            const sideEffectsHtml = product.sideEffects && product.sideEffects.length ? `<ul>${product.sideEffects.map(se => `<li>${se}</li>`).join('')}</ul>` : '<p>Nu sunt efecte secundare cunoscute.</p>';

            popup.innerHTML = `
                <button onclick="closeProductDetail()" style="float: right; background: none; border: none; font-size: 1.2em; cursor: pointer;">√ó</button>
                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">${product.name}</h3>
                <p><strong>Descriere:</strong> ${product.description}</p>
                ${product.administration ? `<p><strong>Administrare:</strong> ${product.administration}</p>` : ''}
                <p><strong>Efecte secundare:</strong></p>
                ${sideEffectsHtml}
                <p style="margin-top: 1rem;"><strong>Pret:</strong> ${product.price} Lei</p>
                <p><strong>Stoc:</strong> ${product.stock}</p>
            ${product.prescription ? '<p><strong style="color: var(--primary-dark);">‚öïÔ∏è NecesitƒÉ Re»õetƒÉ</strong></p>' : ''}
                <div style="margin-top: 1rem; display:flex; gap:1rem;">
                    ${product.prescription ? `<button onclick="addToCart('${product.name.replace(/'/g, "\\'")}', true)">AdaugƒÉ √Æn Co»ô (NecesitƒÉ Re»õetƒÉ)</button>` : `<button onclick="addToCart('${product.name.replace(/'/g, "\\'")}')">AdaugƒÉ √Æn Co»ô</button>`}
                    <button onclick="closeProductDetail()" style="background-color: #9e9e9e;">√énchide</button>
                </div>
            `;

            popup.style.display = 'block';
            popup.style.position = 'fixed';
            popup.style.left = '50%';
            popup.style.top = '50%';
            popup.style.transform = 'translate(-50%, -50%)';
            popup.style.zIndex = '1001';
            popup.style.maxWidth = '600px';
            popup.style.width = '90%';
            popup.style.maxHeight = '80vh';
            popup.style.overflow = 'auto';
        }

        function closeProductDetail() {
            const overlay = document.getElementById('overlay');
            overlay.style.display = 'none';
            const popup = document.getElementById('productDetailPopup');
            if (popup) popup.style.display = 'none';
        }

        function openTab(evt, tabName) {
            let tabcontents = evt.target.parentElement.parentElement.getElementsByClassName("tab-content");
            for (let tabcontent of tabcontents) {
                tabcontent.classList.remove("active");
            }
            let tabs = evt.target.parentElement.getElementsByClassName("tab");
            for (let tab of tabs) {
                tab.classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.target.classList.add("active");
        }

        // simple addToCart removed ‚Äî using the unified addToCart(itemName, requiresPrescription=false)

        function updatePriceValue(value) {
            document.getElementById('priceValue').textContent = value + ' Lei';
            filterProducts();
        }

        function filterProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const prescriptionFilterEl = document.getElementById('prescriptionFilter');
            const prescriptionFilter = prescriptionFilterEl ? prescriptionFilterEl.value : 'all';
            const maxPriceEl = document.getElementById('priceRange');
            const maxPrice = maxPriceEl ? parseFloat(maxPriceEl.value) : 100;

            const filtered = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm);
                const matchesCategory = category === 'all' || product.category === category;
                const matchesPrescription = prescriptionFilter === 'all' || 
                    (prescriptionFilter === 'yes' && product.prescription) ||
                    (prescriptionFilter === 'no' && !product.prescription);
                const matchesPrice = product.price <= maxPrice;

                return matchesSearch && matchesCategory && matchesPrescription && matchesPrice;
            });

            renderProducts(filtered);
        }

        function renderProducts(productsToShow) {
            const grid = document.querySelector('.product-grid');
            grid.innerHTML = '';

            productsToShow.forEach(product => {
                const safeId = product.name.replace(/\s+/g, '');
                // Escape single quotes in product name so it can be safely used inside single-quoted attributes
                const escapedName = product.name.replace(/'/g, "\\'");
                const card = document.createElement('div');
                card.className = 'card product-card';
                card.innerHTML = `
                    <h3 style="cursor: pointer;" onclick="showProductDetails('${escapedName}')">${product.name}</h3>
                    <div class="tabs">
                        <button class="tab active" onclick="openTab(event, 'description${safeId}')">Descriere</button>
                    </div>
                    <div id="description${safeId}" class="tab-content active">
                        <p>${product.description}</p>
                        ${product.administration ? `<p><strong>Administrare:</strong> ${product.administration}</p>` : ''}
                        <p>Cantitate √Æn stoc: ${product.stock}</p>
                        <p style="color: var(--primary-color); font-weight: bold; font-size: 1.2em;">${product.price} Lei</p>
                        ${product.prescription ? '<p><strong style="color: var(--primary-dark);">‚öïÔ∏è NecesitƒÉ Re»õetƒÉ</strong></p>' : ''}
                    </div>
                    <button onclick="addToCart('${product.name}', ${product.prescription})">${product.prescription ? 'AdaugƒÉ √Æn Co»ô (NecesitƒÉ Re»õetƒÉ)' : 'AdaugƒÉ √Æn Co»ô'}</button>
                `;
                grid.appendChild(card);
            });
        }

        function addToCart(itemName, requiresPrescription = false) {
            const product = products.find(p => p.name === itemName);
            if (!product) return;

            // If product requires prescription, we don't show the old prescription-popup here.
            // Instead we add the item to cart and inform user they'll upload the prescription at checkout.
            if (requiresPrescription) {
                cart.push({
                    name: product.name,
                    price: product.price,
                    requiresPrescription: true
                });

                cartCount++;
                document.getElementById('cart-count').textContent = cartCount;
                updateCartDisplay();

                const toast = document.createElement('div');
                toast.style.position = 'fixed';
                toast.style.bottom = '20px';
                toast.style.right = '20px';
                toast.style.backgroundColor = 'var(--primary-color)';
                toast.style.color = 'white';
                toast.style.padding = '1rem';
                toast.style.borderRadius = '8px';
                toast.style.boxShadow = 'var(--shadow)';
                toast.style.transition = 'opacity 0.3s ease';
                toast.style.zIndex = '1000';
                toast.textContent = `${itemName} necesitƒÉ re»õetƒÉ ‚Äî o pute»õi √ÆncƒÉrca la finalizarea comenzii.`;
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => document.body.removeChild(toast), 300);
                }, 3000);

                return;
            }

            cart.push({
                name: product.name,
                price: product.price
            });
            
            cartCount++;
            document.getElementById('cart-count').textContent = cartCount;
            updateCartDisplay();

            // Show toast notification
            const toast = document.createElement('div');
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.right = '20px';
            toast.style.backgroundColor = 'var(--primary-color)';
            toast.style.color = 'white';
            toast.style.padding = '1rem';
            toast.style.borderRadius = '8px';
            toast.style.boxShadow = 'var(--shadow)';
            toast.style.transition = 'opacity 0.3s ease';
            toast.style.zIndex = '1000';
            toast.textContent = `${itemName} a fost adƒÉugat √Æn co»ô!`;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 2000);
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            cartItems.innerHTML = '';
            let total = 0;

            cart.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.style.display = 'flex';
                itemElement.style.justifyContent = 'space-between';
                itemElement.style.alignItems = 'center';
                itemElement.style.padding = '0.5rem 0';
                itemElement.style.borderBottom = '1px solid var(--border-color)';
                
                itemElement.innerHTML = `
                    <span>${item.name}</span>
                    <div>
                        <span style="margin-right: 1rem">${item.price} Lei</span>
                        <button onclick="removeFromCart(${index})" style="color: var(--error-color); background: none; border: none; cursor: pointer;">√ó</button>
                    </div>
                `;
                cartItems.appendChild(itemElement);
                total += item.price;
            });

            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; color: var(--text-color-light);">Co»ôul este gol</p>';
            }

            cartTotal.textContent = total.toFixed(2) + ' Lei';
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            cartCount--;
            document.getElementById('cart-count').textContent = cartCount;
            updateCartDisplay();
        }

        function showBasket() {
            const cartPopup = document.getElementById('cartPopup');
            cartPopup.style.display = cartPopup.style.display === 'none' ? 'block' : 'none';
            updateCartDisplay();
        }

        // Clear the cart completely
        function clearCart() {
            cart = [];
            cartCount = 0;
            document.getElementById('cart-count').textContent = cartCount;
            updateCartDisplay();
        }

        // Checkout flow: if any item requires prescription, require an upload
        function checkout() {
            if (!cart || cart.length === 0) {
                alert('Co»ôul este gol.');
                return;
            }

            const total = cart.reduce((s, it) => s + (it.price || 0), 0);
            const needsPrescription = cart.some(it => it.requiresPrescription === true);

            if (needsPrescription) {
                showPrescriptionModal(total);
            } else {
                showConfirmModal(total);
            }
        }

        function showConfirmModal(total) {
            const overlay = document.getElementById('overlay');
            overlay.style.display = 'block';

            let modal = document.getElementById('checkoutModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'checkoutModal';
                modal.className = 'modal';
                modal.style.display = 'block';
                modal.style.position = 'fixed';
                modal.style.left = '50%';
                modal.style.top = '50%';
                modal.style.transform = 'translate(-50%, -50%)';
                modal.style.zIndex = '1002';
                modal.style.background = 'var(--background-color)';
                modal.style.padding = '1rem';
                modal.style.border = '1px solid var(--border-color)';
                modal.style.borderRadius = '8px';
                modal.style.maxWidth = '500px';
                modal.style.width = '90%';
                document.body.appendChild(modal);
            }

            modal.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="color:var(--primary-color); margin:0;">Confirmare comandƒÉ</h3>
                    <button onclick="closeCheckoutModal()" style="background:none; border:none; font-size:1.2em; cursor:pointer;">√ó</button>
                </div>
                <div style="margin-top:1rem;">
                    <p>Ve»õi trimite comanda cu <strong>${cart.length}</strong> produse.</p>
                    <p>Total: <strong>${total.toFixed(2)} Lei</strong></p>
                </div>
                <div style="margin-top:1rem; display:flex; gap:8px; justify-content:flex-end;">
                    <button onclick="closeCheckoutModal()" style="background:transparent; border:1px solid var(--border-color); padding:8px 12px; border-radius:6px; cursor:pointer;">AnuleazƒÉ</button>
                    <button onclick="finalizeOrder()" style="background:var(--primary-color); color:var(--card-color); padding:8px 12px; border-radius:6px; border:none; cursor:pointer;">ConfirmƒÉ »ôi plaseazƒÉ comanda</button>
                </div>
            `;
        }

        function showPrescriptionModal(total) {
            const overlay = document.getElementById('overlay');
            overlay.style.display = 'block';

            let modal = document.getElementById('checkoutModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'checkoutModal';
                modal.className = 'modal';
                modal.style.position = 'fixed';
                modal.style.left = '50%';
                modal.style.top = '50%';
                modal.style.transform = 'translate(-50%, -50%)';
                modal.style.zIndex = '1002';
                modal.style.background = 'var(--background-color)';
                modal.style.padding = '1rem';
                modal.style.border = '1px solid var(--border-color)';
                modal.style.borderRadius = '8px';
                modal.style.maxWidth = '520px';
                modal.style.width = '95%';
                document.body.appendChild(modal);
            }

            const requiredList = cart.filter(i => i.requiresPrescription).map(i => `<li>${i.name} ‚Äî ${i.price} Lei</li>`).join('');

            modal.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="color:var(--primary-color); margin:0;">√éncƒÉrca»õi re»õeta</h3>
                    <button onclick="closeCheckoutModal()" style="background:none; border:none; font-size:1.2em; cursor:pointer;">√ó</button>
                </div>
                <div style="margin-top:1rem;">
                    <p>UrmƒÉtoarele produse necesitƒÉ re»õetƒÉ:</p>
                    <ul>${requiredList}</ul>
                    <p>Total comandƒÉ: <strong>${total.toFixed(2)} Lei</strong></p>
                </div>
                <div style="margin-top:1rem; display:flex; flex-direction:column; gap:8px;">
                    <label for="prescriptionFile">Alege»õi fi»ôierul cu re»õeta (pozƒÉ sau PDF):</label>
                    <input id="prescriptionFile" type="file" accept="image/*,application/pdf" />
                </div>
                <div style="margin-top:1rem; display:flex; gap:8px; justify-content:flex-end;">
                    <button onclick="closeCheckoutModal()" style="background:transparent; border:1px solid var(--border-color); padding:8px 12px; border-radius:6px; cursor:pointer;">AnuleazƒÉ</button>
                    <button onclick="submitPrescriptionAndPlaceOrder()" style="background:var(--primary-color); color:var(--card-color); padding:8px 12px; border-radius:6px; border:none; cursor:pointer;">√éncarcƒÉ re»õeta »ôi plaseazƒÉ comanda</button>
                </div>
            `;
        }

        function closeCheckoutModal() {
            const modal = document.getElementById('checkoutModal');
            if (modal) modal.style.display = 'none';
            const overlay = document.getElementById('overlay');
            if (overlay) overlay.style.display = 'none';
        }

        function submitPrescriptionAndPlaceOrder() {
            const fileInput = document.getElementById('prescriptionFile');
            if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                alert('VƒÉ rugƒÉm sƒÉ selecta»õi un fi»ôier cu re»õeta √Ænainte de a continua.');
                return;
            }

            // In a real app: upload fileInput.files[0] to server together with cart details
            // For this demo we just simulate success
            finalizeOrder();
        }

        function finalizeOrder() {
            //* Fetch checkout endpoint to place order
            fetch('api/checkout.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                //* Send cart items to server
                body: JSON.stringify({
                    cart: cart
                })
            })
            //* Parse server response
            .then(response => response.json())
            //* Handle successful order placement
            .then(data => {
                if (data.success) {
                    //* Clear cart after successful order
                    clearCart();
                    closeCheckoutModal();
                    const toast = document.createElement('div');
                    toast.style.position = 'fixed';
                    toast.style.bottom = '20px';
                    toast.style.right = '20px';
                    toast.style.backgroundColor = 'var(--primary-color)';
                    toast.style.color = 'white';
                    toast.style.padding = '1rem';
                    toast.style.borderRadius = '8px';
                    toast.style.boxShadow = 'var(--shadow)';
                    toast.style.transition = 'opacity 0.3s ease';
                    toast.style.zIndex = '1000';
                    toast.textContent = 'Comanda a fost plasatƒÉ cu succes! Ve»õi primi confirmare prin e-mail.';
                    document.body.appendChild(toast);
                    setTimeout(() => {
                        toast.style.opacity = '0';
                        setTimeout(() => document.body.removeChild(toast), 300);
                    }, 3000);
                } else {
                    alert('Eroare la plasarea comenzii: ' + (data.message || 'Eroare necunoscutƒÉ'));
                }
            })
            //* Handle fetch errors
            .catch(error => {
                alert('Eroare de conectare: ' + error.message);
                console.error('Error:', error);
            });
        }

    </script>
    <script>
        // Theme management
        function setTheme(isDark) {
            document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (isDark) {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Mod Luminos';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Mod √éntunecat';
            }

            // Update CSS variables for theme (pink / purple / white palette)
            if (isDark) {
                // Dark variant: deep background with pink/purple accents
                document.documentElement.style.setProperty('--background-color', '#0f0b12');
                document.documentElement.style.setProperty('--text-color', '#f3eefe');
                document.documentElement.style.setProperty('--card-color', '#1b0f1a');
                document.documentElement.style.setProperty('--border-color', '#2a1626');
                document.documentElement.style.setProperty('--primary-color', '#ff79b0'); // softer pink
                document.documentElement.style.setProperty('--primary-dark', '#8e24aa'); // purple
                document.documentElement.style.setProperty('--error-color', '#e91e63');
                document.documentElement.style.setProperty('--text-color-light', '#cfc0d6');
                document.documentElement.style.setProperty('--shadow', '0 2px 10px rgba(142,36,170,0.18)');
            } else {
                // Light variant: white background with pink/purple accents
                document.documentElement.style.setProperty('--background-color', '#ffffff');
                document.documentElement.style.setProperty('--text-color', '#222222');
                document.documentElement.style.setProperty('--card-color', '#ffffff');
                document.documentElement.style.setProperty('--border-color', '#f6e9f6');
                document.documentElement.style.setProperty('--primary-color', '#ff4081'); // bright pink
                document.documentElement.style.setProperty('--primary-dark', '#7b1fa2'); // deep purple
                document.documentElement.style.setProperty('--error-color', '#e91e63');
                document.documentElement.style.setProperty('--text-color-light', '#757575');
                document.documentElement.style.setProperty('--shadow', '0 2px 10px rgba(123,31,162,0.08)');
            }
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            setTheme(currentTheme !== 'dark');
        }

        // Check for saved theme preference or system preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            setTheme(savedTheme === 'dark');
        } else {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            setTheme(prefersDark);
        }

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (!localStorage.getItem('theme')) {
                setTheme(e.matches);
            }
        });

        // Sign In functionality
        function showSignIn() {
            const signInWindow = document.getElementById('signInWindow');
            signInWindow.style.display = 'block';
        }

        function closeSignIn() {
            const signInWindow = document.getElementById('signInWindow');
            signInWindow.style.display = 'none';
        }

        function handleSignIn(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            closeSignIn();
        }

        // ===== THREE SIMPLE DOM MANIPULATIONS =====

        // DOM 1: Show/Hide filter card with smooth animation
        function toggleFilterCard() {
            const filterCard = document.querySelector('.filters-card');
            if (!filterCard) return;
            
            if (filterCard.style.display === 'none') {
                filterCard.style.display = 'block';
                filterCard.style.animation = 'slideDown 0.3s ease';
            } else {
                filterCard.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    filterCard.style.display = 'none';
                }, 300);
            }
        }

        // DOM 2: Clear all filters and reset to default view
        function resetAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = 'all';
            document.getElementById('prescriptionFilter').value = 'all';
            document.getElementById('priceRange').value = '200';
            document.getElementById('priceValue').textContent = '200 Lei';
            
            // Re-render all products
            filterProducts();
            
            // Show success message
            showNotification('Filtre resetate cu succes!');
        }

        // DOM 3: Change product grid layout (2 columns, 3 columns, 4 columns)
        function changeGridLayout(columns) {
            const productGrid = document.querySelector('.product-grid');
            if (productGrid) {
                productGrid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            }
            showNotification(`Afi»ôare √Æn ${columns} coloane`);
        }

        // Helper function to show notifications
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.background = 'var(--primary-color)';
            notification.style.color = 'white';
            notification.style.padding = '12px 20px';
            notification.style.borderRadius = '6px';
            notification.style.boxShadow = 'var(--shadow)';
            notification.style.zIndex = '2000';
            notification.style.animation = 'slideIn 0.3s ease';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { opacity: 0; transform: translateY(-20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            @keyframes slideUp {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(-20px); }
            }
            @keyframes slideIn {
                from { opacity: 0; transform: translateX(100px); }
                to { opacity: 1; transform: translateX(0); }
            }
            @keyframes slideOut {
                from { opacity: 1; transform: translateX(0); }
                to { opacity: 0; transform: translateX(100px); }
            }
        `;
        document.head.appendChild(style);

    </script>

    <div id="signInWindow" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeSignIn()">&times;</span>
            <h2>Autentificare</h2>
            <form onsubmit="handleSignIn(event)">
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">ParolƒÉ:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="submit-btn">Autentificare</button>
            </form>
        </div>
    </div>
</body>
</html>